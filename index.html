<script src="https://cdnjs.cloudflare.com/ajax/libs/antd/4.16.13/antd.min.js"></script>
<script>
    // Helper to get selected checkbox values
    function getSelectedValues(id) {
        const checkboxes = document.querySelectorAll(`#${id} input[type="checkbox"]:checked`);
        return Array.from(checkboxes).map(cb => cb.value);
    }

    // Validate range inputs in "min-max" format
    function validateRange(input, errorElementId) {
        const pattern = /^\d+-\d+$/;
        const errorElement = document.getElementById(errorElementId);
        if (input && !pattern.test(input)) {
            errorElement.innerText = "Invalid format. Use min-max, e.g., 10-50.";
            return false;
        }
        errorElement.innerText = "";
        return true;
    }

    // Form submission handler with logging
    function submitForm() {
        const experienceLevels = getSelectedValues("experience-level");
        const jobTypes = getSelectedValues("job-type");
        const clientHistory = getSelectedValues("client-history");
        const categories = getSelectedValues("category2_uid");
        const hourlyRate = document.getElementById("hourly-rate").value;
        const fixedPrice = document.getElementById("fixed-price").value;
        const keywords = document.getElementById("keywords").value;

        const isHourlyRateValid = validateRange(hourlyRate, "hourly-rate-error");
        const isFixedPriceValid = validateRange(fixedPrice, "fixed-price-error");

        // Log the form data and validation checks
        console.log("Form data:", {
            experienceLevels,
            jobTypes,
            clientHistory,
            categories,
            hourlyRate,
            fixedPrice,
            keywords
        });

        if (!Telegram.WebApp.sendData) {
            console.error("Telegram Web App not initialized properly.");
            alert("Telegram Web App not initialized properly. Please reload and try again.");
            return;
        }

        // Only proceed if all validations pass
        if (isHourlyRateValid && isFixedPriceValid) {
            const formData = {
                experienceLevels,
                jobTypes,
                clientHistory,
                categories,
                hourlyRate,
                fixedPrice,
                keywords
            };
            
            console.log("Sending data to Telegram:", formData);
            Telegram.WebApp.sendData(JSON.stringify(formData));
        }
    }

    // Initialize the Telegram Web App and log
    Telegram.WebApp.ready();
    console.log("Telegram Web App initialized.");
</script>
